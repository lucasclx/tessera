<div class="editor-container">
    <!-- Header com título e ações -->
    <div class="editor-header">
      <div class="header-content">
        <!-- Título da monografia -->
        <div *ngIf="!editingTitle" class="title-display">
          <h1>{{ monografia?.titulo || 'Carregando...' }}</h1>
          <button mat-icon-button color="primary" (click)="startEditTitle()" *ngIf="monografia && (isAutor || isOrientador)">
            <mat-icon>edit</mat-icon>
          </button>
        </div>
        
        <!-- Formulário de edição do título -->
        <div *ngIf="editingTitle" class="title-form">
          <form [formGroup]="titleForm" class="title-edit-form">
            <mat-form-field appearance="outline">
              <input matInput formControlName="titulo" placeholder="Título da Monografia">
              <mat-error *ngIf="titleForm.get('titulo')?.hasError('required')">
                Título é obrigatório
              </mat-error>
            </mat-form-field>
            
            <div class="form-actions">
              <button mat-icon-button color="primary" type="button" (click)="saveTitle()" [disabled]="titleForm.invalid">
                <mat-icon>check</mat-icon>
              </button>
              <button mat-icon-button color="warn" type="button" (click)="cancelEditTitle()">
                <mat-icon>close</mat-icon>
              </button>
            </div>
          </form>
        </div>
        
        <!-- Ações do editor -->
        <div class="editor-actions">
          <button mat-button color="primary" (click)="toggleTimeline()">
            <mat-icon>history</mat-icon>
            {{ showTimeline ? 'Ocultar histórico' : 'Ver histórico' }}
          </button>
          
          <button mat-button color="primary" (click)="toggleComments()">
            <mat-icon>comment</mat-icon>
            {{ showComments ? 'Ocultar comentários' : 'Ver comentários' }}
          </button>
          
          <button mat-raised-button color="primary" (click)="openSaveDialog()" *ngIf="isAutor || isOrientador">
            <mat-icon>save</mat-icon>
            Salvar nova versão
          </button>
          
          <button mat-icon-button [matMenuTriggerFor]="exportMenu" matTooltip="Exportar">
            <mat-icon>file_download</mat-icon>
          </button>
          <mat-menu #exportMenu="matMenu">
            <button mat-menu-item (click)="exportarPDF()">
              <mat-icon>picture_as_pdf</mat-icon>
              Exportar como PDF
            </button>
            <button mat-menu-item (click)="exportarDOCX()">
              <mat-icon>description</mat-icon>
              Exportar como DOCX
            </button>
          </mat-menu>
          
          <button mat-icon-button (click)="compartilhar()" matTooltip="Compartilhar">
            <mat-icon>share</mat-icon>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Área principal do editor -->
    <div class="editor-main">
      <!-- Mensagem de carregamento -->
      <div *ngIf="loading" class="loading-overlay">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Carregando conteúdo...</p>
      </div>
      
      <!-- Mensagem de erro -->
      <div *ngIf="error" class="error-message">
        <mat-icon>error_outline</mat-icon>
        <p>{{ error }}</p>
        <button mat-raised-button color="primary" (click)="carregarMonografia()">Tentar novamente</button>
      </div>
      
      <!-- Conteúdo principal -->
      <div class="editor-content" [class.with-sidebar]="showTimeline || showComments">
        <!-- Editor de texto rico -->
        <app-rich-text-editor
          *ngIf="!loading && !error"
          [content]="documentContent"
          [monografiaId]="monografiaId"
          [versaoId]="currentVersaoId"
          [readOnly]="!isAutor && !isOrientador"
          (contentChange)="onContentChange($event)">
        </app-rich-text-editor>
      </div>
      
      <!-- Painel lateral de histórico de versões -->
      <div *ngIf="showTimeline" class="sidebar timeline-sidebar">
        <div class="sidebar-header">
          <h2>Histórico de Versões</h2>
          <button mat-icon-button (click)="toggleTimeline()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        
        <div class="sidebar-content">
          <app-versao-timeline
            [monografiaId]="monografiaId"
            (versaoSelected)="previewVersao($event)"
            (versoesComparadas)="compararVersoes($event)">
          </app-versao-timeline>
        </div>
      </div>
      
      <!-- Painel lateral de comentários -->
      <div *ngIf="showComments" class="sidebar comments-sidebar">
        <div class="sidebar-header">
          <h2>Comentários</h2>
          <button mat-icon-button (click)="toggleComments()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        
        <div class="sidebar-content">
          <app-comentarios
            *ngIf="currentVersaoId"
            [versaoId]="currentVersaoId">
          </app-comentarios>
        </div>
      </div>
    </div>
    
    <!-- Modal de comparação de versões -->
    <div *ngIf="showDiff" class="diff-overlay">
      <app-versao-diff-viewer
        [versaoBase]="diffBaseVersao"
        [versaoNova]="diffNovaVersao"
        [onClose]="fecharComparacao.bind(this)">
      </app-versao-diff-viewer>
    </div>
  </div>
  
  <!-- Template para o diálogo de salvar versão -->
  <ng-template #saveVersionDialog>
    <h2 mat-dialog-title>Salvar Nova Versão</h2>
    
    <mat-dialog-content>
      <form [formGroup]="saveForm">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Mensagem da versão</mat-label>
          <textarea matInput formControlName="mensagemCommit" placeholder="Descreva as alterações realizadas..." rows="4"></textarea>
          <mat-error *ngIf="saveForm.get('mensagemCommit')?.hasError('required')">
            Mensagem é obrigatória
          </mat-error>
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Tag (opcional)</mat-label>
          <input matInput formControlName="tag" placeholder="Ex: Rascunho, Final, Revisão">
          <mat-hint>Adicione uma tag para identificar versões importantes</mat-hint>
        </mat-form-field>
      </form>
    </mat-dialog-content>
    
    <mat-dialog-actions align="end">
      <button mat-button mat-dialog-close>Cancelar</button>
      <button mat-raised-button color="primary" (click)="salvarVersao()" [disabled]="saveForm.invalid || savingVersion">
        <mat-spinner diameter="20" *ngIf="savingVersion"></mat-spinner>
        <mat-icon *ngIf="!savingVersion">save</mat-icon>
        {{ savingVersion ? 'Salvando...' : 'Salvar Versão' }}
      </button>
    </mat-dialog-actions>
  </ng-template>